#!/usr/bin/env python3
import sys
import os
sys.path.append(os.path.dirname(os.path.dirname(os.path.realpath(__file__))))
import pseudo_python
import pseudo_python.errors
import yaml

def z():
    if len(sys.argv) == 1:
        print('pseudo-python <filename>')
        return

    filename = sys.argv[1]
    with open(filename, 'r') as f:
        source = f.read()
    try:
        yaml.Dumper.ignore_aliases = lambda *args : True
        clj = yaml.dump(pseudo_python.translate(source))
        base = filename.rpartition('.')[0]
        with open('%s.pseudo.yaml' % base, 'w') as f:
            f.write(clj)
    except pseudo_python.errors.PseudoPythonNotTranslatableError as e:
        print(e)

if __name__ == '__main__':
    z()
